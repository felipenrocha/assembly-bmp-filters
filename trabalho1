
	.data 0x10110000
	endereco_imagem: .space 0x1000000
	.data 0x10210000
	arquivobmp: .asciiz "lena.bmp"
	buffer:	.space 786486 #n° max caracteres 

.text



main:
#Abre o arquivo com sycscall:
	la $a0, arquivobmp
	li $v0, 13
	li $a1, 0
	li $a2, 0		
	syscall	
#v0 agora possui o descriptor da imagem
	move $s1, $v0 		#Descriptor salvo em #s1
	move $a0, $v0		#Descriptor em $a0
	li $v0, 14		#Syscall 14
	la $a1, buffer
	li $a2, 262144	
	syscall		
#v0 agora possui o N° de caracteres no arquivo

	bltz $v0, exit		#Caso o arquivo seja nulo(0 caracteres), o programa termina.
	move $s2, $v0		#$S2 = N° caracteres			

# Syscall para fechar arquivo
	li   $v0, 16       	
	move $a0, $s1  #Descriptor = $s1    	
	syscall            	

#Formatação da imagem(Pegando apenas o bitmap[])


	subi $s2,$s2,54		#Retira o BitmapHeader(Cabeçalho)(54 bytes)
	div $s2,$s2,3		#Divide por três para receber as words, (1byte para Red, 1 p/ Green e 1p/ Blue)
	la $s0, buffer	
	addi $s0,$s0,54
	la $s3, endereco_imagem
	
	li $s4, 0 	
	
loop1:
	beq $s4, $s2, endloop1	#s2 = numero de words, s4 = variavel para loop = 0

	
loopcarregabyte:
	#lbu/sb = carrega e salva os bytes do arquivo e passa para o endereço:$s3
	li $t0,0 #contador
	lbu $s5, ($s0)		#carrega os bytes RGB 
	sb $s5, ($s3)		#salva o byte carregado p/ buffer da imagem	
	addi $s0, $s0, 1
	addi $s3, $s3, 1
	beq $t0,3,loopcarregabyte

	sb $zero, ($s3)		#adiciona o byte 00	
	addi $s3, $s3, 1

	addi $s4, $s4, 1
	
	j  loop1
	
endloop1:
	subi $s0, $s3,4 		#endereço p/ ultimos 4 bytes
	la $s3, endereco_imagem		#recarrega o end inicial
loop2:

	
exit:	#Syscall de exit
	li $v0, 11
	syscall
	


	
